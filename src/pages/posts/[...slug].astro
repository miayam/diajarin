---
import { getCollection } from "astro:content";
import Post from "@/layouts/Post.astro";
import client from "@tina/__generated__/client";
import AdminPost from "@tina/pages/AdminPost";

export async function getStaticPaths() {
    const posts = await getCollection("post");

    return posts.map((post) => ({
        params: { slug: post.id },
        props: {
            post,
            getTinaProps: async () =>
                client.queries.post({
                    relativePath: post.data.tinaInfo.relativePath,
                }),
        },
    }));
}

const { getTinaProps } = Astro.props;
const tinaProps = await getTinaProps();
---

<Post {...tinaProps}>
    <AdminPost {...tinaProps} client:tina />
</Post>
